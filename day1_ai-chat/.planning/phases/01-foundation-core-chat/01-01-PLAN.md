---
phase: 01-foundation-core-chat
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - tailwind.config.ts
  - app/layout.tsx
  - app/page.tsx
  - app/globals.css
  - app/api/chat/route.ts
  - lib/deepseek.ts
  - .env.local
  - .env.example
  - .gitignore
autonomous: true
must_haves:
  truths:
    - "Next.js 15 dev server starts without errors on localhost:3030"
    - "POST /api/chat with a messages array returns a streaming SSE response"
    - "DeepSeek API key is only accessed server-side (never in client bundles)"
    - "DeepSeek model name is configurable via DEEPSEEK_MODEL env var"
  artifacts:
    - path: "app/api/chat/route.ts"
      provides: "Streaming chat endpoint using Vercel AI SDK + DeepSeek"
      exports: ["POST"]
    - path: "lib/deepseek.ts"
      provides: "DeepSeek client configuration"
      exports: ["deepseek"]
    - path: "app/layout.tsx"
      provides: "Root layout with metadata"
    - path: "app/page.tsx"
      provides: "Placeholder page (replaced in Plan 02)"
    - path: ".env.example"
      provides: "Environment variable documentation"
      contains: "DEEPSEEK_API_KEY"
  key_links:
    - from: "app/api/chat/route.ts"
      to: "lib/deepseek.ts"
      via: "import { deepseek }"
      pattern: "import.*deepseek.*from.*lib/deepseek"
    - from: "app/api/chat/route.ts"
      to: "ai"
      via: "streamText + toDataStreamResponse"
      pattern: "streamText|toDataStreamResponse"
---

<objective>
Scaffold the Next.js 15 project and create the streaming DeepSeek API route.

Purpose: Establish the project foundation and prove that streaming from DeepSeek works before building any UI. The API route is the riskiest piece (external dependency, streaming complexity) and should be validated first.

Output: A running Next.js 15 app with a POST /api/chat endpoint that streams DeepSeek responses via Vercel AI SDK.
</objective>

<execution_context>
@/Users/maxlee/.claude/get-shit-done/workflows/execute-plan.md
@/Users/maxlee/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-core-chat/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 15 project and install all Phase 1 dependencies</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    tailwind.config.ts
    app/layout.tsx
    app/page.tsx
    app/globals.css
    .env.local
    .env.example
    .gitignore
  </files>
  <action>
    Create the Next.js 15 project in the current directory (which is currently empty except for .planning/, .claude/, .git/, .idea/).

    Run: `npx create-next-app@latest . --typescript --tailwind --app --no-src-dir --eslint --no-import-alias --use-npm`

    Note: Using `.` to scaffold in the current directory. The `--no-src-dir` flag keeps app/ at root level (not src/app/). Using npm (not yarn/pnpm) for simplicity.

    After scaffold completes, install all Phase 1 dependencies in one command:
    `npm install ai @ai-sdk/deepseek react-markdown remark-gfm react-textarea-autosize`

    Create `.env.local` with:
    ```
    DEEPSEEK_API_KEY=
    DEEPSEEK_MODEL=deepseek-chat
    ```

    Create `.env.example` (committed to git, no secrets) with:
    ```
    # Get your API key from https://platform.deepseek.com/
    DEEPSEEK_API_KEY=sk-your-key-here
    # Default model - cheapest option
    DEEPSEEK_MODEL=deepseek-chat
    ```

    Ensure `.gitignore` includes `.env.local` (create-next-app should handle this, but verify).

    Replace the default `app/page.tsx` with a minimal placeholder:
    ```tsx
    export default function Home() {
      return (
        <main className="flex min-h-screen items-center justify-center">
          <p className="text-lg text-gray-600">Chat UI coming in Plan 02</p>
        </main>
      );
    }
    ```

    Update `app/layout.tsx` metadata title to "Day1 AI Chat" and description to "Chat with AI powered by DeepSeek".

    Strip the default globals.css down to just the Tailwind directives (remove all the default Next.js custom properties and styles, keep only the @import "tailwindcss" or @tailwind directives that create-next-app generates).
  </action>
  <verify>
    Run `npm run dev` in background, wait 5 seconds, then `curl -s http://localhost:3030` should return HTML containing "Chat UI coming in Plan 02". Kill the dev server after verification. Also verify `npm run build` succeeds without errors.
  </verify>
  <done>
    Next.js 15 project runs on localhost:3030, all Phase 1 npm packages installed, .env.local and .env.example exist, .gitignore covers .env.local.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DeepSeek client config and streaming API route</name>
  <files>
    lib/deepseek.ts
    app/api/chat/route.ts
  </files>
  <action>
    Create `lib/deepseek.ts` — the DeepSeek client configuration:
    ```typescript
    import { createDeepSeek } from '@ai-sdk/deepseek';

    export const deepseek = createDeepSeek({
      apiKey: process.env.DEEPSEEK_API_KEY ?? '',
    });
    ```

    Create `app/api/chat/route.ts` — the streaming endpoint:
    ```typescript
    import { streamText } from 'ai';
    import { deepseek } from '@/lib/deepseek';

    export async function POST(req: Request) {
      const { messages } = await req.json();

      const result = streamText({
        model: deepseek(process.env.DEEPSEEK_MODEL ?? 'deepseek-chat'),
        messages,
        maxTokens: 4096,
      });

      return result.toDataStreamResponse();
    }
    ```

    Key points:
    - Use `@/lib/deepseek` path alias (Next.js default tsconfig has `@/*` mapped to `./*`)
    - Do NOT add try/catch wrapper around streamText — the AI SDK handles stream errors and sends them to the client via the data stream protocol, which `useChat` (Plan 02) will surface via its `error` property. Wrapping in try/catch would prevent the stream from starting.
    - `maxTokens: 4096` is a sensible default for conversational responses
    - The route only exports POST (no GET needed)
    - DEEPSEEK_API_KEY is accessed only in the server-side lib file, never exposed to client

    Verify the path alias works: check that `tsconfig.json` (from create-next-app) contains `"@/*": ["./*"]` in compilerOptions.paths. If not, add it.
  </action>
  <verify>
    Run `npm run build` — should compile without errors. The route.ts should appear in the build output as a serverless function.

    If user has set DEEPSEEK_API_KEY in .env.local, also test with:
    ```bash
    curl -X POST http://localhost:3030/api/chat \
      -H "Content-Type: application/json" \
      -d '{"messages":[{"role":"user","content":"Say hello in one word"}]}'
    ```
    This should return streaming data (SSE format). If no API key is set, the build verification alone is sufficient.
  </verify>
  <done>
    `lib/deepseek.ts` exports configured DeepSeek client. `app/api/chat/route.ts` exports POST handler that streams responses via Vercel AI SDK. Project builds without errors.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run dev` starts server on localhost:3030
3. The `/api/chat` route exists and accepts POST requests
4. No DEEPSEEK_API_KEY reference appears in any client-side code or public directory
5. `.env.example` documents required environment variables
</verification>

<success_criteria>
- Next.js 15 project scaffolded with TypeScript, Tailwind CSS, App Router
- All Phase 1 dependencies installed (ai, @ai-sdk/deepseek, react-markdown, remark-gfm, react-textarea-autosize)
- DeepSeek streaming API route at POST /api/chat works with Vercel AI SDK
- Environment variables properly configured (.env.local for secrets, .env.example for documentation)
- Project builds and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-chat/01-01-SUMMARY.md`
</output>
